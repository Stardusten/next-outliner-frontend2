import{_ as p,a as U,L as b,C}from"./Input.vue_vue_type_script_setup_true_lang-9lKhZL8M.js";import{_ as h,a as V,b as E,c as I,d as P}from"./CardTitle.vue_vue_type_script_setup_true_lang-DeW3jETZ.js";import{_ as R,a as T}from"./CardFooter.vue_vue_type_script_setup_true_lang-eOfy4FTl.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-DiM_UGrc.js";import{d as z,e as x,p as A,q as B,o as d,f as g,w as n,g as e,S as M,r as X,a as l,h as t,t as r,i as v,j,c as D,X as L,k,z as O,s as q,n as F,R as w}from"./index-DgbYwIvn.js";const N={class:"grid items-center w-full gap-4"},W={class:"flex flex-col space-y-3"},G={class:"flex flex-col space-y-2"},H={key:0,class:"text-red-500 flex items-center text-sm mt-2"},J=z({__name:"AdminLoginView",setup(K){const{serverUrl:c,token:$}=M.useContext(),m=x(""),{t:y}=A(),a=x("idle"),f=B(()=>["idle","loggingIn","loginSuccess"].includes(a.value)?null:y(`login.adminLogin.errMsg.${a.value}`)),S=async()=>{a.value="loggingIn";const s=c.value,o=O.string().url().safeParse(s);if(!o.success){console.log("URL \u683C\u5F0F\u4E0D\u6B63\u786E, err=",o.error),a.value="invalidServerUrl";return}const[i]=await Promise.all([T({serverUrl:s,password:m.value}),q(2e3)]);i.success?(a.value="loginSuccess",$.value=i.data.token,setTimeout(()=>{const u=encodeURIComponent(s);F.push(`/admin-dashboard/${u}`)},2e3)):i.code===w.PASSWORD_INCORRECT?a.value="invalidPassword":i.code===w.EXCEED_MAX_ATTEMPTS?a.value="maxAttempts":a.value="cannotConnectToServer"};return(s,o)=>{const i=X("router-link");return d(),g(e(P),{class:"w-[400px]"},{default:n(()=>[l(e(E),null,{default:n(()=>[l(e(h),null,{default:n(()=>[t(r(s.$t("login.adminLogin.title")),1)]),_:1}),l(e(V))]),_:1}),l(e(I),null,{default:n(()=>[v("div",N,[v("div",W,[l(e(_),null,{default:n(()=>[t(r(s.$t("login.adminLogin.serverUrlLabel")),1)]),_:1}),l(e(p),{modelValue:e(c),"onUpdate:modelValue":o[0]||(o[0]=u=>j(c)?c.value=u:null),placeholder:s.$t("login.adminLogin.serverUrlPlaceholder")},null,8,["modelValue","placeholder"])]),v("div",G,[l(e(_),null,{default:n(()=>[t(r(s.$t("login.adminLogin.passwordLabel")),1)]),_:1}),l(e(p),{modelValue:m.value,"onUpdate:modelValue":o[1]||(o[1]=u=>m.value=u),type:"password"},null,8,["modelValue"])])]),f.value?(d(),D("div",H,[l(e(L),{class:"size-4 mr-2"}),t(" "+r(f.value),1)])):k("",!0)]),_:1}),l(e(R),{class:"flex justify-center gap-8"},{default:n(()=>[l(i,{to:"/login/kb-editor",class:"text-sm text-muted-foreground hover:text-foreground transition-colors duration-300"},{default:n(()=>[t(r(s.$t("login.adminLogin.kbEditorLoginBtn")),1)]),_:1}),l(e(U),{class:"min-w-[100px]",onClick:S,disabled:a.value==="loggingIn"},{default:n(()=>[a.value==="loggingIn"?(d(),g(e(b),{key:0,class:"size-4 mr-2 animate-spin"})):a.value==="loginSuccess"?(d(),g(e(C),{key:1,class:"size-4 mr-2"})):a.value!=="idle"?(d(),g(e(L),{key:2,class:"size-4 mr-2"})):k("",!0),t(" "+r(s.$t(`login.adminLogin.loginBtn.${a.value}`)??s.$t("login.adminLogin.loginBtn.loginFailed")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})}}});export{J as default};
